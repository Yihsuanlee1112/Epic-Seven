package com.github.arenaofvalor.presentation.controller;import android.content.SharedPreferences;import com.github.arenaofvalor.Constants;import com.github.arenaofvalor.Singletons;import com.github.arenaofvalor.presentation.model.ArenaOfValorResponse;import com.github.arenaofvalor.presentation.model.Hero;import com.github.arenaofvalor.presentation.view.MainActivity;import com.google.gson.Gson;import com.google.gson.reflect.TypeToken;import java.lang.reflect.Type;import java.util.ArrayList;import java.util.List;import retrofit2.Call;import retrofit2.Callback;import retrofit2.Response;public class MainController {    private SharedPreferences sharedPreferences;    private Gson gson;    private MainActivity view;    private List<Hero> AovHeroes = new ArrayList<>();    public MainController(MainActivity mainActivity, Gson gson, SharedPreferences sharedPreferences){        this.view = mainActivity;        this.gson = gson;        this.sharedPreferences = sharedPreferences;    }    public void onStart(){        List<Hero> AovHeroes= getDataFromCache();        if(getDataFromCache()!= null)            view.showList(AovHeroes);        else            APIcall();    }    private void APIcall(){        //Log.d("REBECCA", "BEFORE CALLBACK");        Call<ArenaOfValorResponse> call = Singletons.getArenaOfValorAPI().getHeroResponse();        call.enqueue(new Callback<ArenaOfValorResponse>() {            @Override            public void onResponse(Call<ArenaOfValorResponse> call, Response<ArenaOfValorResponse> response) {                //Log.d("REBECCA", "INSIDE CALLBACK");                if(response.isSuccessful()&& response.body()!= null){                    AovHeroes = response.body().getResults();                    saveList(AovHeroes);                    //Toast.makeText(getApplicationContext(), "API Success", Toast.LENGTH_SHORT).show();                    view.showList(AovHeroes);                }                else{                    view.showError();                }            }            @Override            public void onFailure(Call<ArenaOfValorResponse> call, Throwable t) {                view .showError();            }        });        //Log.d("REBECCA", "AFTER CALLBACK");    }    private void saveList(List<Hero> aovHeroes) {        String jsonString = gson.toJson(AovHeroes);        sharedPreferences                .edit()                .putString(Constants.KEY_HERO_LIST, jsonString)                .apply();        // Toast.makeText(getApplicationContext(), "List save", Toast.LENGTH_SHORT).show();    }    private List<Hero> getDataFromCache() {        String jsonHero = sharedPreferences.getString(Constants.KEY_HERO_LIST, null) ;        if(jsonHero ==null)            return null;        else {            Type listType = new TypeToken<List<Hero>>() {            }.getType();            return gson.fromJson(jsonHero, listType);        }    }    public void onItemClick(Hero hero){        view.navigateToDetails(hero);    }    private void onButtonAClick(){    }    public void onButtonBclick(){    }}